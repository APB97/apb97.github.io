@implements IDisposable

@inject APB97StringLocalizer<Challenges> localization
@inject IJSRuntime JS
@inject APB97StringLocalizerFactory LocalizationFactory

@if (ShouldRender())
{
    <AdjustedAnchorHeading Id="challenges">@localization.Localize("Challenges")</AdjustedAnchorHeading>

    <div class="d-flex" style="font-size: larger">
        <ul style="list-style-type: none;">
            <li>
                <a class="link-primary" href="/IntegerToRoman"><span>@localization.Localize("Integer to Roman")</span></a>
            </li>
            <li>
                <a class="link-primary" href="/CountAndSay"><span>@localization.Localize("Count and say")</span></a>
            </li>
        </ul>
    </div>
}

@code {
    protected override bool ShouldRender()
    {
        if (localization.Localization == null) return false;
        return base.ShouldRender();
    }

    protected override async Task OnInitializedAsync()
    {
        localization = new APB97StringLocalizer<Challenges>(LocalizationFactory);
        await localization.InitializeAsync(LanguageSelect.Culture);
    }

    protected override void OnInitialized()
    {
        MainLayout.OnStateChanging += GetResources;
    }

    void IDisposable.Dispose()
    {
        MainLayout.OnStateChanging -= GetResources;
    }

    private async Task GetResources()
    {
        localization = new APB97StringLocalizer<Challenges>(LocalizationFactory);
        await localization.InitializeAsync(LanguageSelect.Culture);
        StateHasChanged();
    }
}

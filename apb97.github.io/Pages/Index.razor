@page "/"
@using apb97.github.io.Shared
@using apb97.github.io.Shared.Extensions

@implements IAsyncDisposable

@inject UtilityService utilities
@inject NavigationManager Navigation

<PageTitle>Adrian Bieliński - Index</PageTitle>

<AboutMe />

<NavigationByIdFix @ref="navFix" />

@code {
    private NavigationByIdFix? navFix;

    private CancellationTokenSource cts = new();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;
        var target = await Navigation.NavigateToStoredDestinationIfAnyAsync(utilities);
        if (navFix is null) return;
        if (string.IsNullOrEmpty(target))
            target = Navigation.Uri.Replace(Navigation.BaseUri, string.Empty);
        while (!LocalizedComponent<LearningProgress>.Ready())
            await Task.Delay(25, cts.Token);
        await navFix.ScrollToElementFixAsync(Navigation, target, 300, cts.Token);
    }

    async ValueTask IAsyncDisposable.DisposeAsync()
    {
        await cts.CancelAsync();
    }
}
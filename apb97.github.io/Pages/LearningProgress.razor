@page "/LearningProgress/{Year:int=2024}"

@using Microsoft.Extensions.Localization
@using System.Reflection;
@using apb97.github.io.Shared
@inject IStringLocalizer<LearningProgress> Localizer
@inject NavigationManager Navigation

<PageTitle>Adrian Bieliński - @LanguageSelect.GetStringSafely(Localizer,"LearningProgress", Layout.Language) @Year</PageTitle>

<h2>@LanguageSelect.GetStringSafely(Localizer,"LearningProgress", Layout.Language)</h2>

<label>@LanguageSelect.GetStringSafely(Localizer,"Year", Layout.Language)</label>
<InputNumber TValue="int" Value="Year" ValueChanged="OnYearChanged" ValueExpression="() => Year" min="@MinYear" max="@RecentYear" />

<DynamicComponent Type="GetDynamicComponentType(Year)" />

@code {
    [CascadingParameter]
    public required MainLayout Layout { get; set; }

    [Parameter]
    public int Year { get; set; } = RecentYear;

    private const int MinYear = 2022;
    private const int RecentYear = 2024;

    private Type GetDynamicComponentType(int year)
    {
        var assembly = Assembly.GetAssembly(typeof(LearningProgress2024));
        var currentYearType = assembly?.GetType($"apb97.github.io.Shared.LearningProgress{year}");
        return currentYearType ?? typeof(LearningProgress2024);
    }

    private void OnYearChanged(int year)
    {
        if (year > RecentYear)
        {
            Navigation.NavigateTo($"/LearningProgress/{RecentYear}");
        }
        else if (year < MinYear)
        {
            Navigation.NavigateTo($"/LearningProgress/{MinYear}");
        }
        else
        {
            Navigation.NavigateTo($"/LearningProgress/{year}");
        }
    }
}